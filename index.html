<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ライドシェアプラットフォーム</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    form {
      margin-bottom: 20px;
    }
    input, select, button {
      display: block;
      margin: 5px 0;
      padding: 10px;
      width: 100%;
    }
    .message {
      color: green;
    }
    .error {
      color: red;
    }
    #home-screen {
      display: none;
    }
  </style>
</head>
<body>
  <h1>ライドシェアプラットフォームへようこそ！</h1>

  <!-- ユーザー登録フォーム -->
  <h2>登録</h2>
  <form id="register-form">
    <input type="text" id="register-name" placeholder="名前" required />
    <input type="email" id="register-email" placeholder="メールアドレス" required />
    <input type="password" id="register-password" placeholder="パスワード" required />
    <input type="text" id="register-studentId" placeholder="学生ID" required />
    <select id="register-userType" required>
      <option value="">役割を選択</option>
      <option value="driver">運転者</option>
      <option value="passenger">同乗者</option>
    </select>
    <button type="submit">登録</button>
  </form>
  <p id="register-message" class="message"></p>

  <!-- ログインフォーム -->
  <h2>ログイン</h2>
  <form id="login-form">
    <input type="email" id="login-email" placeholder="メールアドレス" required />
    <input type="password" id="login-password" placeholder="パスワード" required />
    <button type="submit">ログイン</button>
  </form>
  <p id="error-message" class="error"></p>

  <!-- ホーム画面 -->
  <div id="home-screen">
    <h2>ホーム画面</h2>

    <!-- プロフィール編集欄 -->
    <h3>プロフィール編集</h3>
    <form id="edit-profile-form">
      <input type="text" id="edit-name" placeholder="名前" />
      <input type="email" id="edit-email" placeholder="メールアドレス" />
      <input type="text" id="edit-studentId" placeholder="学生ID" />
      <button type="submit">変更を保存</button>
    </form>
    <p id="edit-profile-message" class="message"></p>

    <!-- ライド募集作成欄（運転者のみ） -->
    <h3>ライド募集作成 (運転者のみ)</h3>
    <form id="create-ride-form">
      <input type="text" id="ride-departure" placeholder="出発地" required />
      <input type="text" id="ride-destination" placeholder="目的地" required />
      <input type="datetime-local" id="ride-dateTime" required />
      <input type="number" id="ride-seats" placeholder="空き座席数" required min="1" />
      <button type="submit">募集を作成</button>
    </form>
    <p id="create-ride-message" class="message"></p>

    <!-- 募集閲覧欄 -->
    <h3>利用可能なライド</h3>
    <div id="ride-list"></div>

    <!-- ログアウトボタン -->
    <button id="logout-button">ログアウト</button>
  </div>

  <script>
    // ページ読み込み時の処理
    window.onload = async function () {
      const token = localStorage.getItem("token");
      if (token) {
        document.getElementById("home-screen").style.display = "block";
        document.getElementById("register-form").style.display = "none";
        document.getElementById("login-form").style.display = "none";
        await loadAvailableRides();
      } else {
        document.getElementById("home-screen").style.display = "none";
        document.getElementById("register-form").style.display = "block";
        document.getElementById("login-form").style.display = "block";
      }
    };

    // 登録処理
    document.getElementById("register-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      document.getElementById("register-message").textContent = ""; // 初期化
      const name = document.getElementById("register-name").value;
      const email = document.getElementById("register-email").value;
      const password = document.getElementById("register-password").value;
      const studentId = document.getElementById("register-studentId").value;
      const userType = document.getElementById("register-userType").value;

      const response = await fetch("/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, password, student_id: studentId, userType }),
      });

      const registerMessage = document.getElementById("register-message");
      if (response.ok) {
        registerMessage.textContent = "登録が成功しました！メールを確認してください。";
      } else {
        const result = await response.json();
        registerMessage.textContent = result.message || "登録に失敗しました。";
        registerMessage.style.color = "red";
      }
    });

    // ログイン処理
    document.getElementById("login-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;

      const errorMessage = document.getElementById("error-message");
      errorMessage.textContent = ""; // 初期化

      const response = await fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      });
      const result = await response.json();

      if (result.token) {
        alert("ログインが成功しました！");
        localStorage.setItem("token", result.token);
        document.getElementById("home-screen").style.display = "block";
        document.getElementById("register-form").style.display = "none";
        document.getElementById("login-form").style.display = "none";
        await loadAvailableRides();
      } else {
        errorMessage.textContent = result.message || "ログインに失敗しました。資格情報を確認してください。";
      }
    });

    // その他の処理は変更なし
  </script>
</body>
</html>
